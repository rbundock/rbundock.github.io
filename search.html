<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Posts</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js"></script>
</head>
<body>
    <div>
        <label for="search">Enter your search term:</label>
        <input type="text" id="search">
        <button onclick="performSearch()">Search</button>
    </div>
    
    <div id="results"></div>

    <script>
        class Posts {
            constructor() {
                this.posts = [];
                this.index = lunr(function() {
                    this.ref('id');
                    this.field('title', { boost: 10 });
                    this.field('categories', { boost: 5 });
                    this.field('excerpt');
                });
                console.log(this.index);
            }

            fetch() {
                return fetch('/data/posts.json')
                    .then(response => response.json())
                    .then(data => {
                        this.posts = this.parse(data);
                        this.posts.forEach(post => this.index.add(post));
                    })
                    .catch(error => {
                        console.error("There was an error fetching the posts:", error);
                    });
            }

            parse(posts) {
                return posts.map(post => {
                    post.categories = post.categories.replace(/\s+/g, '').split(',');
                    return post;
                });
            }

            filter(term) {
                let results = this.index.search(term);
                return results.map(result => {
                    return this.posts.find(post => post.id === result.ref);
                });
            }
        }

        const myPosts = new Posts();
        myPosts.fetch();

        function performSearch() {
            const searchTerm = document.getElementById('search').value;
            const results = myPosts.filter(searchTerm);
            displayResults(results);
        }

        function displayResults(posts) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            posts.forEach(post => {
                resultsDiv.innerHTML += `
                    <div>
                        <h3>${post.title}</h3>
                        <p>${post.excerpt}</p>
                        <p><strong>Categories:</strong> ${post.categories.join(', ')}</p>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
